(()=>{var e={424:(e,t,s)=>{e.exports={RBTree:s(448),BinTree:s(675)}},675:(e,t,s)=>{var r=s(301);function i(e){this.data=e,this.left=null,this.right=null}function n(e){this._root=null,this._comparator=e,this.size=0}i.prototype.get_child=function(e){return e?this.right:this.left},i.prototype.set_child=function(e,t){e?this.right=t:this.left=t},n.prototype=new r,n.prototype.insert=function(e){if(null===this._root)return this._root=new i(e),this.size++,!0;for(var t=0,s=null,r=this._root;;){if(null===r)return r=new i(e),s.set_child(t,r),ret=!0,this.size++,!0;if(0===this._comparator(r.data,e))return!1;t=this._comparator(r.data,e)<0,s=r,r=r.get_child(t)}},n.prototype.remove=function(e){if(null===this._root)return!1;var t=new i(void 0),s=t;s.right=this._root;for(var r=null,n=null,o=1;null!==s.get_child(o);){r=s,s=s.get_child(o);var a=this._comparator(e,s.data);o=a>0,0===a&&(n=s)}return null!==n&&(n.data=s.data,r.set_child(r.right===s,s.get_child(null===s.left)),this._root=t.right,this.size--,!0)},e.exports=n},448:(e,t,s)=>{var r=s(301);function i(e){this.data=e,this.left=null,this.right=null,this.red=!0}function n(e){this._root=null,this._comparator=e,this.size=0}function o(e){return null!==e&&e.red}function a(e,t){var s=e.get_child(!t);return e.set_child(!t,s.get_child(t)),s.set_child(t,e),e.red=!0,s.red=!1,s}function c(e,t){return e.set_child(!t,a(e.get_child(!t),!t)),a(e,t)}i.prototype.get_child=function(e){return e?this.right:this.left},i.prototype.set_child=function(e,t){e?this.right=t:this.left=t},n.prototype=new r,n.prototype.insert=function(e){var t=!1;if(null===this._root)this._root=new i(e),t=!0,this.size++;else{var s=new i(void 0),r=0,n=0,l=null,h=s,u=null,p=this._root;for(h.right=this._root;;){if(null===p?(p=new i(e),u.set_child(r,p),t=!0,this.size++):o(p.left)&&o(p.right)&&(p.red=!0,p.left.red=!1,p.right.red=!1),o(p)&&o(u)){var m=h.right===l;p===u.get_child(n)?h.set_child(m,a(l,!n)):h.set_child(m,c(l,!n))}var d=this._comparator(p.data,e);if(0===d)break;n=r,r=d<0,null!==l&&(h=l),l=u,u=p,p=p.get_child(r)}this._root=s.right}return this._root.red=!1,t},n.prototype.remove=function(e){if(null===this._root)return!1;var t=new i(void 0),s=t;s.right=this._root;for(var r=null,n=null,l=null,h=1;null!==s.get_child(h);){var u=h;n=r,r=s,s=s.get_child(h);var p=this._comparator(e,s.data);if(h=p>0,0===p&&(l=s),!o(s)&&!o(s.get_child(h)))if(o(s.get_child(!h))){var m=a(s,h);r.set_child(u,m),r=m}else if(!o(s.get_child(!h))){var d=r.get_child(!u);if(null!==d)if(o(d.get_child(!u))||o(d.get_child(u))){var f=n.right===r;o(d.get_child(u))?n.set_child(f,c(r,u)):o(d.get_child(!u))&&n.set_child(f,a(r,u));var g=n.get_child(f);g.red=!0,s.red=!0,g.left.red=!1,g.right.red=!1}else r.red=!1,d.red=!0,s.red=!0}}return null!==l&&(l.data=s.data,r.set_child(r.right===s,s.get_child(null===s.left)),this.size--),this._root=t.right,null!==this._root&&(this._root.red=!1),null!==l},e.exports=n},301:e=>{function t(){}function s(e){this._tree=e,this._ancestors=[],this._cursor=null}t.prototype.clear=function(){this._root=null,this.size=0},t.prototype.find=function(e){for(var t=this._root;null!==t;){var s=this._comparator(e,t.data);if(0===s)return t.data;t=t.get_child(s>0)}return null},t.prototype.findIter=function(e){for(var t=this._root,s=this.iterator();null!==t;){var r=this._comparator(e,t.data);if(0===r)return s._cursor=t,s;s._ancestors.push(t),t=t.get_child(r>0)}return null},t.prototype.lowerBound=function(e){for(var t=this._root,s=this.iterator(),r=this._comparator;null!==t;){var i=r(e,t.data);if(0===i)return s._cursor=t,s;s._ancestors.push(t),t=t.get_child(i>0)}for(var n=s._ancestors.length-1;n>=0;--n)if(r(e,(t=s._ancestors[n]).data)<0)return s._cursor=t,s._ancestors.length=n,s;return s._ancestors.length=0,s},t.prototype.upperBound=function(e){for(var t=this.lowerBound(e),s=this._comparator;null!==t.data()&&0===s(t.data(),e);)t.next();return t},t.prototype.min=function(){var e=this._root;if(null===e)return null;for(;null!==e.left;)e=e.left;return e.data},t.prototype.max=function(){var e=this._root;if(null===e)return null;for(;null!==e.right;)e=e.right;return e.data},t.prototype.iterator=function(){return new s(this)},t.prototype.each=function(e){for(var t,s=this.iterator();null!==(t=s.next());)e(t)},t.prototype.reach=function(e){for(var t,s=this.iterator();null!==(t=s.prev());)e(t)},s.prototype.data=function(){return null!==this._cursor?this._cursor.data:null},s.prototype.next=function(){if(null===this._cursor){var e=this._tree._root;null!==e&&this._minNode(e)}else{var t;if(null===this._cursor.right)do{if(t=this._cursor,!this._ancestors.length){this._cursor=null;break}this._cursor=this._ancestors.pop()}while(this._cursor.right===t);else this._ancestors.push(this._cursor),this._minNode(this._cursor.right)}return null!==this._cursor?this._cursor.data:null},s.prototype.prev=function(){if(null===this._cursor){var e=this._tree._root;null!==e&&this._maxNode(e)}else{var t;if(null===this._cursor.left)do{if(t=this._cursor,!this._ancestors.length){this._cursor=null;break}this._cursor=this._ancestors.pop()}while(this._cursor.left===t);else this._ancestors.push(this._cursor),this._maxNode(this._cursor.left)}return null!==this._cursor?this._cursor.data:null},s.prototype._minNode=function(e){for(;null!==e.left;)this._ancestors.push(e),e=e.left;this._cursor=e},s.prototype._maxNode=function(e){for(;null!==e.right;)this._ancestors.push(e),e=e.right;this._cursor=e},e.exports=t},76:(e,t,s)=>{"use strict";t.register=s(583).globalRegistry,t.Registry=s(583),t.contentType=s(583).globalRegistry.contentType,t.validateMetricName=s(609).validateMetricName,t.Counter=s(696),t.Gauge=s(162),t.Histogram=s(24),t.Summary=s(548),t.Pushgateway=s(553),t.linearBuckets=s(884).linearBuckets,t.exponentialBuckets=s(884).exponentialBuckets,t.collectDefaultMetrics=s(38),t.aggregators=s(930).aggregators,t.AggregatorRegistry=s(252)},884:(e,t)=>{"use strict";t.linearBuckets=(e,t,s)=>{if(s<1)throw new Error("Linear buckets needs a positive count");const r=new Array(s);for(let i=0;i<s;i++)r[i]=e+i*t;return r},t.exponentialBuckets=(e,t,s)=>{if(e<=0)throw new Error("Exponential buckets needs a positive start");if(s<1)throw new Error("Exponential buckets needs a positive count");if(t<=1)throw new Error("Exponential buckets needs a factor greater than 1");const r=new Array(s);for(let i=0;i<s;i++)r[i]=e,e*=t;return r}},252:(e,t,s)=>{"use strict";const r=s(583),{Grouper:i}=s(580),{aggregators:n}=s(930);let o=()=>{const e=s(1);return o=()=>e,e};const a="prom-client:getMetricsReq",c="prom-client:getMetricsRes";let l=[r.globalRegistry],h=0,u=!1;const p=new Map;class m extends r{constructor(){super(),u||(u=!0,o().isMaster&&o().on("message",((e,t)=>{if(t.type===c){const e=p.get(t.requestId);if(t.error)return void e.done(new Error(t.error));if(t.metrics.forEach((t=>e.responses.push(t))),e.pending--,0===e.pending){p.delete(t.requestId),clearTimeout(e.errorTimeout);const s=m.aggregate(e.responses).metrics();e.done(null,s)}}})),o().isWorker&&process.on("message",(e=>{e.type===a&&Promise.all(l.map((e=>e.getMetricsAsJSON()))).then((t=>{process.send({type:c,requestId:e.requestId,metrics:t})})).catch((t=>{process.send({type:c,requestId:e.requestId,error:t.message})}))})))}clusterMetrics(){const e=h++;return new Promise(((t,s)=>{let r=!1;function i(e,i){r||(r=!0,e?s(e):t(i))}const n={responses:[],pending:0,done:i,errorTimeout:setTimeout((()=>{const e=new Error("Operation timed out.");n.done(e)}),5e3)};p.set(e,n);const c={type:a,requestId:e};for(const e in o().workers)o().workers[e].isConnected()&&(o().workers[e].send(c),n.pending++);0===n.pending&&(clearTimeout(n.errorTimeout),process.nextTick((()=>i(null,""))))}))}static aggregate(e){const t=new r,s=new i;return e.forEach((e=>{e.forEach((e=>{s.add(e.name,e)}))})),s.forEach((e=>{const s=e[0].aggregator,r=n[s];if("function"!=typeof r)throw new Error(`'${s}' is not a defined aggregator.`);const i=r(e);if(i){const e=Object.assign({get:()=>i},i);t.registerMetric(e)}})),t}static setRegistries(e){Array.isArray(e)||(e=[e]),e.forEach((e=>{if(!(e instanceof r))throw new TypeError("Expected Registry, got "+typeof e)})),l=e}}e.exports=m},696:(e,t,s)=>{"use strict";const r=s(837),{hashObject:i,isObject:n,getLabels:o,removeLabels:a}=s(580),{validateLabel:c}=s(609),{Metric:l}=s(362);function h(e,t,s={},r=""){return e[r]?e[r].value+=t:e[r]={value:t,labels:s},e}e.exports=class extends l{inc(e,t){let s;if(n(e)?(s=i(e),c(this.labelNames,e)):(t=e,e={}),t&&!Number.isFinite(t))throw new TypeError(`Value is not a valid number: ${r.format(t)}`);if(t<0)throw new Error("It is not possible to decrease a counter");null==t&&(t=1),h(this.hashMap,t,e,s)}reset(){this.hashMap={},0===this.labelNames.length&&h(this.hashMap,0)}async get(){if(this.collect){const e=this.collect();e instanceof Promise&&await e}return{help:this.help,name:this.name,type:"counter",values:Object.values(this.hashMap),aggregator:this.aggregator}}labels(...e){const t=o(this.labelNames,e)||{};return{inc:this.inc.bind(this,t)}}remove(...e){const t=o(this.labelNames,e)||{};return c(this.labelNames,t),a.call(this,this.hashMap,t)}}},38:(e,t,s)=>{"use strict";const{isObject:r}=s(580),i={processCpuTotal:s(523),processStartTime:s(140),osMemoryHeap:s(157),processOpenFileDescriptors:s(483),processMaxFileDescriptors:s(844),eventLoopLag:s(807),processHandles:s(802),processRequests:s(308),heapSizeAndUsed:s(482),heapSpacesSizeAndUsed:s(888),version:s(256),gc:s(493)},n=Object.keys(i);e.exports=function(e){if(null!=e&&!r(e))throw new TypeError("config must be null, undefined, or an object");e={eventLoopMonitoringPrecision:10,...e};for(const t of Object.values(i))t(e.register,e)},e.exports.metricsList=n},162:(e,t,s)=>{"use strict";const r=s(837),{setValue:i,getLabels:n,hashObject:o,isObject:a,removeLabels:c}=s(580),{validateLabel:l}=s(609),{Metric:h}=s(362);function u(e,t,s){if("number"!=typeof s)throw new TypeError(`Value is not a valid number: ${r.format(s)}`);l(e.labelNames,t),i(e.hashMap,s,t)}function p(e){return a(e)?e:{}}function m(e,t){return a(e)?t:e}e.exports=class extends h{set(e,t){t=m(e,t),u(this,e=p(e),t)}reset(){this.hashMap={},0===this.labelNames.length&&i(this.hashMap,0,{})}inc(e,t){void 0===(t=m(e,t))&&(t=1),u(this,e=p(e),this._getValue(e)+t)}dec(e,t){void 0===(t=m(e,t))&&(t=1),u(this,e=p(e),this._getValue(e)-t)}setToCurrentTime(e){const t=Date.now()/1e3;void 0===e?this.set(t):this.set(e,t)}startTimer(e){const t=process.hrtime();return s=>{const r=process.hrtime(t);this.set(Object.assign({},e,s),r[0]+r[1]/1e9)}}async get(){if(this.collect){const e=this.collect();e instanceof Promise&&await e}return{help:this.help,name:this.name,type:"gauge",values:Object.values(this.hashMap),aggregator:this.aggregator}}_getValue(e){const t=o(e||{});return this.hashMap[t]?this.hashMap[t].value:0}labels(...e){const t=n(this.labelNames,e);return l(this.labelNames,t),{inc:this.inc.bind(this,t),dec:this.dec.bind(this,t),set:this.set.bind(this,t),setToCurrentTime:this.setToCurrentTime.bind(this,t),startTimer:this.startTimer.bind(this,t)}}remove(...e){const t=n(this.labelNames,e);l(this.labelNames,t),c.call(this,this.hashMap,t)}}},24:(e,t,s)=>{"use strict";const r=s(837),{getLabels:i,hashObject:n,isObject:o,removeLabels:a}=s(580),{validateLabel:c}=s(609),{Metric:l}=s(362);function h(e){return()=>{const t=process.hrtime();return s=>{const r=process.hrtime(t),i=r[0]+r[1]/1e9;return this.observe(Object.assign({},e,s),i),i}}}function u(e,t,s){return{labels:e,value:t,metricName:s}}function p(e){return t=>{const s=function(e,t){return o(e)?{labels:e,value:t}:{value:e,labels:{}}}(e,t);if(c(this.labelNames,s.labels),!Number.isFinite(s.value))throw new TypeError(`Value is not a valid number: ${r.format(s.value)}`);const i=n(s.labels);let a=this.hashMap[i];a||(a=m(s.labels,Object.assign({},this.bucketValues)));const l=function(e,t){for(let s=0;s<e.length;s++){const r=e[s];if(t<=r)return r}return-1}(this.upperBounds,s.value);a.sum+=s.value,a.count+=1,Object.prototype.hasOwnProperty.call(a.bucketValues,l)&&(a.bucketValues[l]+=1),this.hashMap[i]=a}}function m(e,t){return{labels:e,bucketValues:t,sum:0,count:0}}e.exports=class extends l{constructor(e){super(e,{buckets:[.005,.01,.025,.05,.1,.25,.5,1,2.5,5,10]});for(const e of this.labelNames)if("le"===e)throw new Error("le is a reserved label keyword");this.upperBounds=this.buckets,this.bucketValues=this.upperBounds.reduce(((e,t)=>(e[t]=0,e)),{}),Object.freeze(this.bucketValues),Object.freeze(this.upperBounds),0===this.labelNames.length&&(this.hashMap={[n({})]:m({},Object.assign({},this.bucketValues))})}observe(e,t){p.call(this,0===e?0:e||{})(t)}async get(){if(this.collect){const e=this.collect();e instanceof Promise&&await e}const e=Object.values(this.hashMap).map((t=this,e=>{const s=[],r=Object.keys(e.labels);let i=0;for(const n of t.upperBounds){i+=e.bucketValues[n];const o={le:n};for(const t of r)o[t]=e.labels[t];s.push(u(o,i,`${t.name}_bucket`))}return{buckets:s,data:e}})).reduce(function(e){return(t,s)=>{t.push(...s.buckets);const r={le:"+Inf"};for(const e of Object.keys(s.data.labels))r[e]=s.data.labels[e];return t.push(u(r,s.data.count,`${e.name}_bucket`),u(s.data.labels,s.data.sum,`${e.name}_sum`),u(s.data.labels,s.data.count,`${e.name}_count`)),t}}(this),[]);var t;return{name:this.name,help:this.help,type:"histogram",values:e,aggregator:this.aggregator}}reset(){this.hashMap={}}zero(e){const t=n(e);this.hashMap[t]=m(e,Object.assign({},this.bucketValues))}startTimer(e){return h.call(this,e)()}labels(...e){const t=i(this.labelNames,e);return c(this.labelNames,t),{observe:p.call(this,t),startTimer:h.call(this,t)}}remove(...e){const t=i(this.labelNames,e);c(this.labelNames,t),a.call(this,this.hashMap,t)}}},362:(e,t,s)=>{"use strict";const{globalRegistry:r}=s(583),{isObject:i}=s(580),{validateMetricName:n,validateLabelName:o}=s(609);e.exports={Metric:class{constructor(e,t={}){if(!i(e))throw new TypeError("constructor expected a config object");if(Object.assign(this,{labelNames:[],registers:[r],aggregator:"sum"},t,e),this.registers||(this.registers=[r]),!this.help)throw new Error("Missing mandatory help parameter");if(!this.name)throw new Error("Missing mandatory name parameter");if(!n(this.name))throw new Error("Invalid metric name");if(!o(this.labelNames))throw new Error("Invalid label name");if(this.collect&&"function"!=typeof this.collect)throw new Error('Optional "collect" parameter must be a function');this.reset();for(const e of this.registers)e.registerMetric(this)}reset(){}}}},930:(e,t,s)=>{"use strict";const{Grouper:r,hashObject:i}=s(580);function n(e){return t=>{if(0===t.length)return;const s={help:t[0].help,name:t[0].name,type:t[0].type,values:[],aggregator:t[0].aggregator},n=new r;return t.forEach((e=>{e.values.forEach((e=>{const t=i(e.labels);n.add(`${e.metricName}_${t}`,e)}))})),n.forEach((t=>{if(0===t.length)return;const r={value:e(t),labels:t[0].labels};t[0].metricName&&(r.metricName=t[0].metricName),s.values.push(r)})),s}}t.AggregatorFactory=n,t.aggregators={sum:n((e=>e.reduce(((e,t)=>e+t.value),0))),first:n((e=>e[0].value)),omit:()=>{},average:n((e=>e.reduce(((e,t)=>e+t.value),0)/e.length)),min:n((e=>e.reduce(((e,t)=>Math.min(e,t.value)),1/0))),max:n((e=>e.reduce(((e,t)=>Math.max(e,t.value)),-1/0)))}},807:(e,t,s)=>{"use strict";const r=s(162);let i;try{i=s(74)}catch{}const n="nodejs_eventloop_lag_seconds",o="nodejs_eventloop_lag_min_seconds",a="nodejs_eventloop_lag_max_seconds",c="nodejs_eventloop_lag_mean_seconds",l="nodejs_eventloop_lag_stddev_seconds",h="nodejs_eventloop_lag_p50_seconds",u="nodejs_eventloop_lag_p90_seconds",p="nodejs_eventloop_lag_p99_seconds";function m(e,t,s){const r=process.hrtime(e),i=(1e9*r[0]+r[1])/1e9;t.set(s,i)}e.exports=(e,t={})=>{const s=t.prefix?t.prefix:"",d=t.labels?t.labels:{},f=Object.keys(d),g=e?[e]:void 0;let _;if(i&&i.monitorEventLoopDelay){const e=i.monitorEventLoopDelay({resolution:t.eventLoopMonitoringPrecision});e.enable(),_=()=>{const t=process.hrtime();setImmediate(m,t,b,d),v.set(d,e.min/1e9),y.set(d,e.max/1e9),w.set(d,e.mean/1e9),x.set(d,e.stddev/1e9),N.set(d,e.percentile(50)/1e9),j.set(d,e.percentile(90)/1e9),M.set(d,e.percentile(99)/1e9),e.reset()}}else _=()=>{const e=process.hrtime();setImmediate(m,e,b,d)};const b=new r({name:s+n,help:"Lag of event loop in seconds.",registers:g,labelNames:f,aggregator:"average",collect:_}),v=new r({name:s+o,help:"The minimum recorded event loop delay.",registers:g,labelNames:f,aggregator:"min"}),y=new r({name:s+a,help:"The maximum recorded event loop delay.",registers:g,labelNames:f,aggregator:"max"}),w=new r({name:s+c,help:"The mean of the recorded event loop delays.",registers:g,labelNames:f,aggregator:"average"}),x=new r({name:s+l,help:"The standard deviation of the recorded event loop delays.",registers:g,labelNames:f,aggregator:"average"}),N=new r({name:s+h,help:"The 50th percentile of the recorded event loop delays.",registers:g,labelNames:f,aggregator:"average"}),j=new r({name:s+u,help:"The 90th percentile of the recorded event loop delays.",registers:g,labelNames:f,aggregator:"average"}),M=new r({name:s+p,help:"The 99th percentile of the recorded event loop delays.",registers:g,labelNames:f,aggregator:"average"})},e.exports.metricNames=[n,o,a,c,l,h,u,p]},493:(e,t,s)=>{"use strict";const r=s(24);let i;try{i=s(74)}catch{}const n="nodejs_gc_duration_seconds",o=[.001,.01,.1,1,2,5],a=[];a[i.constants.NODE_PERFORMANCE_GC_MAJOR]="major",a[i.constants.NODE_PERFORMANCE_GC_MINOR]="minor",a[i.constants.NODE_PERFORMANCE_GC_INCREMENTAL]="incremental",a[i.constants.NODE_PERFORMANCE_GC_WEAKCB]="weakcb",e.exports=(e,t={})=>{if(!i)return;const s=t.prefix?t.prefix:"",c=t.labels?t.labels:{},l=Object.keys(c),h=t.gcDurationBuckets?t.gcDurationBuckets:o,u=new r({name:s+n,help:"Garbage collection duration by kind, one of major, minor, incremental or weakcb.",labelNames:["kind",...l],buckets:h,registers:e?[e]:void 0});new i.PerformanceObserver((e=>{const t=e.getEntries()[0],s=t.detail?a[t.detail.kind]:a[t.kind];u.observe(Object.assign({kind:s},c),t.duration/1e3)})).observe({entryTypes:["gc"]})},e.exports.metricNames=[n]},482:(e,t,s)=>{"use strict";const r=s(162),i=s(241),n="nodejs_heap_size_total_bytes",o="nodejs_heap_size_used_bytes",a="nodejs_external_memory_bytes";e.exports=(e,t={})=>{if("function"!=typeof process.memoryUsage)return;const s=t.labels?t.labels:{},c=Object.keys(s),l=e?[e]:void 0,h=t.prefix?t.prefix:"",u=new r({name:h+n,help:"Process heap size from Node.js in bytes.",registers:l,labelNames:c,collect:()=>{const e=i();e&&(u.set(s,e.heapTotal),p.set(s,e.heapUsed),void 0!==e.external&&m.set(s,e.external))}}),p=new r({name:h+o,help:"Process heap size used from Node.js in bytes.",registers:l,labelNames:c}),m=new r({name:h+a,help:"Node.js external memory size in bytes.",registers:l,labelNames:c})},e.exports.metricNames=[n,o,a]},888:(e,t,s)=>{"use strict";const r=s(162),i=s(655),n=["total","used","available"],o={};n.forEach((e=>{o[e]=`nodejs_heap_space_size_${e}_bytes`})),e.exports=(e,t={})=>{const s=e?[e]:void 0,a=t.prefix?t.prefix:"",c=t.labels?t.labels:{},l=["space",...Object.keys(c)],h={};n.forEach((e=>{h[e]=new r({name:a+o[e],help:`Process heap space size ${e} from Node.js in bytes.`,labelNames:l,registers:s})})),h.total.collect=()=>{for(const e of i.getHeapSpaceStatistics()){const t=e.space_name.substr(0,e.space_name.indexOf("_space"));h.total.set({space:t,...c},e.space_size),h.used.set({space:t,...c},e.space_used_size),h.available.set({space:t,...c},e.space_available_size)}}},e.exports.metricNames=Object.values(o)},537:e=>{"use strict";e.exports={aggregateByObjectName:function(e){const t={};for(let s=0;s<e.length;s++){const r=e[s];r&&void 0!==r.constructor&&(Object.hasOwnProperty.call(t,r.constructor.name)?t[r.constructor.name]+=1:t[r.constructor.name]=1)}return t},updateMetrics:function(e,t,s){e.reset();for(const r in t)e.set(Object.assign({type:r},s||{}),t[r])}}},241:e=>{"use strict";e.exports=function(){try{return process.memoryUsage()}catch{return}}},157:(e,t,s)=>{"use strict";const r=s(162),i=s(517),n=s(241),o="process_resident_memory_bytes";e.exports=(e,t)=>"linux"===process.platform?i(e,t):function(e,t={}){const s=t.prefix?t.prefix:"",i=t.labels?t.labels:{},a=Object.keys(i);new r({name:s+o,help:"Resident memory size in bytes.",registers:e?[e]:void 0,labelNames:a,collect(){const e=n();e&&this.set(i,e.rss)}})}(e,t),e.exports.metricNames="linux"===process.platform?i.metricNames:[o]},517:(e,t,s)=>{"use strict";const r=s(162),i=s(147),n=["VmSize","VmRSS","VmData"],o="process_resident_memory_bytes",a="process_virtual_memory_bytes",c="process_heap_bytes";e.exports=(e,t={})=>{const s=e?[e]:void 0,l=t.prefix?t.prefix:"",h=t.labels?t.labels:{},u=Object.keys(h),p=new r({name:l+o,help:"Resident memory size in bytes.",registers:s,labelNames:u,collect(){try{const e=function(e){const t={};return e.split("\n").filter((e=>n.some((t=>0===e.indexOf(t))))).forEach((e=>{const s=e.split(":");let r=s[1].trim();r=r.substr(0,r.length-3),r=1024*Number(r),t[s[0]]=r})),t}(i.readFileSync("/proc/self/status","utf8"));p.set(h,e.VmRSS),m.set(h,e.VmSize),d.set(h,e.VmData)}catch{}}}),m=new r({name:l+a,help:"Virtual memory size in bytes.",registers:s,labelNames:u}),d=new r({name:l+c,help:"Process heap size in bytes.",registers:s,labelNames:u})},e.exports.metricNames=[o,a,c]},523:(e,t,s)=>{"use strict";const r=s(696),i="process_cpu_user_seconds_total",n="process_cpu_system_seconds_total",o="process_cpu_seconds_total";e.exports=(e,t={})=>{const s=e?[e]:void 0,a=t.prefix?t.prefix:"",c=t.labels?t.labels:{},l=Object.keys(c);let h=process.cpuUsage();const u=new r({name:a+i,help:"Total user CPU time spent in seconds.",registers:s,labelNames:l,collect(){const e=process.cpuUsage(),t=e.user-h.user,s=e.system-h.system;h=e,u.inc(c,t/1e6),p.inc(c,s/1e6),m.inc(c,(t+s)/1e6)}}),p=new r({name:a+n,help:"Total system CPU time spent in seconds.",registers:s,labelNames:l}),m=new r({name:a+o,help:"Total user and system CPU time spent in seconds.",registers:s,labelNames:l})},e.exports.metricNames=[i,n,o]},802:(e,t,s)=>{"use strict";const{aggregateByObjectName:r}=s(537),{updateMetrics:i}=s(537),n=s(162),o="nodejs_active_handles",a="nodejs_active_handles_total";e.exports=(e,t={})=>{if("function"!=typeof process._getActiveHandles)return;const s=e?[e]:void 0,c=t.prefix?t.prefix:"",l=t.labels?t.labels:{},h=Object.keys(l);new n({name:c+o,help:"Number of active libuv handles grouped by handle type. Every handle type is C++ class name.",labelNames:["type",...h],registers:s,collect(){const e=process._getActiveHandles();i(this,r(e),l)}}),new n({name:c+a,help:"Total number of active handles.",registers:s,labelNames:h,collect(){const e=process._getActiveHandles();this.set(l,e.length)}})},e.exports.metricNames=[o,a]},844:(e,t,s)=>{"use strict";const r=s(162),i=s(147),n="process_max_fds";let o;e.exports=(e,t={})=>{if(void 0===o)try{const e=i.readFileSync("/proc/self/limits","utf8").split("\n");for(const t of e)if(t.startsWith("Max open files")){const e=t.split(/  +/);o=Number(e[1]);break}}catch{return}if(void 0===o)return;const s=t.prefix?t.prefix:"",a=t.labels?t.labels:{},c=Object.keys(a);new r({name:s+n,help:"Maximum number of open file descriptors.",registers:e?[e]:void 0,labelNames:c,collect(){void 0!==o&&this.set(a,o)}})},e.exports.metricNames=[n]},483:(e,t,s)=>{"use strict";const r=s(162),i=s(147),n=s(282),o="process_open_fds";e.exports=(e,t={})=>{if("linux"!==n.platform)return;const s=t.prefix?t.prefix:"",a=t.labels?t.labels:{},c=Object.keys(a);new r({name:s+o,help:"Number of open file descriptors.",registers:e?[e]:void 0,labelNames:c,collect(){try{const e=i.readdirSync("/proc/self/fd");this.set(a,e.length-1)}catch{}}})},e.exports.metricNames=[o]},308:(e,t,s)=>{"use strict";const r=s(162),{aggregateByObjectName:i}=s(537),{updateMetrics:n}=s(537),o="nodejs_active_requests",a="nodejs_active_requests_total";e.exports=(e,t={})=>{if("function"!=typeof process._getActiveRequests)return;const s=t.prefix?t.prefix:"",c=t.labels?t.labels:{},l=Object.keys(c);new r({name:s+o,help:"Number of active libuv requests grouped by request type. Every request type is C++ class name.",labelNames:["type",...l],registers:e?[e]:void 0,collect(){const e=process._getActiveRequests();n(this,i(e),c)}}),new r({name:s+a,help:"Total number of active requests.",registers:e?[e]:void 0,labelNames:l,collect(){const e=process._getActiveRequests();this.set(c,e.length)}})},e.exports.metricNames=[o,a]},140:(e,t,s)=>{"use strict";const r=s(162),i=Math.round(Date.now()/1e3-process.uptime()),n="process_start_time_seconds";e.exports=(e,t={})=>{const s=t.prefix?t.prefix:"",o=t.labels?t.labels:{},a=Object.keys(o);new r({name:s+n,help:"Start time of the process since unix epoch in seconds.",registers:e?[e]:void 0,labelNames:a,aggregator:"omit",collect(){this.set(o,i)}})},e.exports.metricNames=[n]},256:(e,t,s)=>{"use strict";const r=s(162),i=process.version,n=i.slice(1).split(".").map(Number),o="nodejs_version_info";e.exports=(e,t={})=>{const s=t.prefix?t.prefix:"",a=t.labels?t.labels:{},c=Object.keys(a);new r({name:s+o,help:"Node.js version info.",labelNames:["version","major","minor","patch",...c],registers:e?[e]:void 0,aggregator:"first",collect(){this.labels(i,n[0],n[1],n[2],...Object.values(a)).set(1)}})},e.exports.metricNames=[o]},553:(e,t,s)=>{"use strict";const r=s(310),i=s(685),n=s(687),{globalRegistry:o}=s(583);async function a(e,t,s){const o=r.parse(this.gatewayUrl),a=`${o.pathname&&"/"!==o.pathname?o.pathname:""}/metrics/job/${encodeURIComponent(t)}${function(e){return e?Object.keys(e).map((t=>`/${encodeURIComponent(t)}/${encodeURIComponent(e[t])}`)).join(""):""}(s)}`,c=r.resolve(this.gatewayUrl,a),l=r.parse(c),h=-1!==l.href.search(/^https/)?n:i,u=Object.assign(l,this.requestOptions,{method:e});return new Promise(((t,s)=>{const r=h.request(u,(e=>{let s="";e.setEncoding("utf8"),e.on("data",(e=>{s+=e})),e.on("end",(()=>{t({resp:e,body:s})}))}));r.on("error",(e=>{s(e)})),"DELETE"!==e?this.registry.metrics().then((e=>{r.write(e),r.end()})).catch((e=>{s(e)})):r.end()}))}e.exports=class{constructor(e,t,s){s||(s=o),this.registry=s,this.gatewayUrl=e,this.requestOptions=Object.assign({},t)}pushAdd(e){if(!e||!e.jobName)throw new Error("Missing jobName parameter");return a.call(this,"POST",e.jobName,e.groupings)}push(e){if(!e||!e.jobName)throw new Error("Missing jobName parameter");return a.call(this,"PUT",e.jobName,e.groupings)}delete(e){if(!e||!e.jobName)throw new Error("Missing jobName parameter");return a.call(this,"DELETE",e.jobName,e.groupings)}}},583:(e,t,s)=>{"use strict";const{getValueAsString:r}=s(580);function i(e){return e.replace(/\n/g,"\\n").replace(/\\(?!n)/g,"\\\\")}function n(e){return"string"!=typeof e?e:i(e).replace(/"/g,'\\"')}class o{constructor(){this._metrics={},this._collectors=[],this._defaultLabels={}}getMetricsAsArray(){return Object.values(this._metrics)}async getMetricAsPrometheusString(e){const t=await e.get(),s=i(t.name),o=`# HELP ${s} ${i(t.help)}`,a=`# TYPE ${s} ${t.type}`,c=Object.keys(this._defaultLabels);let l="";for(const e of t.values||[]){if(e.labels=e.labels||{},c.length>0){e.labels=Object.assign({},e.labels);for(const t of c)e.labels[t]=e.labels[t]||this._defaultLabels[t]}let s=e.metricName||t.name;const i=Object.keys(e.labels),o=i.length;if(o>0){let t="",r=0;for(;r<o-1;r++)t+=`${i[r]}="${n(e.labels[i[r]])}",`;t+=`${i[r]}="${n(e.labels[i[r]])}"`,s+=`{${t}}`}l+=`${s} ${r(e.value)}\n`}return`${o}\n${a}\n${l}`.trim()}async metrics(){const e=[];for(const t of this.getMetricsAsArray())e.push(this.getMetricAsPrometheusString(t));return`${(await Promise.all(e)).join("\n\n")}\n`}registerMetric(e){if(this._metrics[e.name]&&this._metrics[e.name]!==e)throw new Error(`A metric with the name ${e.name} has already been registered.`);this._metrics[e.name]=e}clear(){this._metrics={},this._defaultLabels={}}async getMetricsAsJSON(){const e=[],t=Object.keys(this._defaultLabels),s=[];for(const e of this.getMetricsAsArray())s.push(e.get());const r=await Promise.all(s);for(const s of r){if(s.values&&t.length>0)for(const e of s.values){e.labels=Object.assign({},e.labels);for(const s of t)e.labels[s]=e.labels[s]||this._defaultLabels[s]}e.push(s)}return e}removeSingleMetric(e){delete this._metrics[e]}getSingleMetricAsString(e){return this.getMetricAsPrometheusString(this._metrics[e])}getSingleMetric(e){return this._metrics[e]}setDefaultLabels(e){this._defaultLabels=e}resetMetrics(){for(const e in this._metrics)this._metrics[e].reset()}get contentType(){return"text/plain; version=0.0.4; charset=utf-8"}static merge(e){const t=new o;return e.reduce(((e,t)=>e.concat(t.getMetricsAsArray())),[]).forEach(t.registerMetric,t),t}}e.exports=o,e.exports.globalRegistry=new o},548:(e,t,s)=>{"use strict";const r=s(837),{getLabels:i,hashObject:n,removeLabels:o}=s(580),{validateLabel:a}=s(609),{Metric:c}=s(362),l=s(401);function h(e){return()=>{const t=process.hrtime();return s=>{const r=process.hrtime(t);this.observe(Object.assign({},e,s),r[0]+r[1]/1e9)}}}function u(e){return t=>{const s=function(e,t){return void 0===t?{value:e,labels:{}}:{labels:e,value:t}}(e,t);if(a(this.labelNames,e),!Number.isFinite(s.value))throw new TypeError(`Value is not a valid number: ${r.format(s.value)}`);const i=n(s.labels);let o=this.hashMap[i];o||(o={labels:s.labels,td:new l(this.maxAgeSeconds,this.ageBuckets),count:0,sum:0}),o.td.push(s.value),o.count++,o.count%this.compressCount==0&&o.td.compress(),o.sum+=s.value,this.hashMap[i]=o}}e.exports=class extends c{constructor(e){super(e,{percentiles:[.01,.05,.5,.9,.95,.99,.999],compressCount:1e3,hashMap:{}});for(const e of this.labelNames)if("quantile"===e)throw new Error("quantile is a reserved label keyword");0===this.labelNames.length&&(this.hashMap={[n({})]:{labels:{},td:new l(this.maxAgeSeconds,this.ageBuckets),count:0,sum:0}})}observe(e,t){u.call(this,0===e?0:e||{})(t)}async get(){if(this.collect){const e=this.collect();e instanceof Promise&&await e}const e=Object.values(this.hashMap),t=[];return e.forEach((e=>{var s,r,i;(s=e,r=this.percentiles,s.td.compress(),r.map((e=>{const t=s.td.percentile(e);return{labels:Object.assign({quantile:e},s.labels),value:t||0}}))).forEach((e=>{t.push(e)})),t.push((i=e,{metricName:`${this.name}_sum`,labels:i.labels,value:i.sum})),t.push(function(e,t){return{metricName:`${t.name}_count`,labels:e.labels,value:e.count}}(e,this))})),{name:this.name,help:this.help,type:"summary",values:t,aggregator:this.aggregator}}reset(){Object.values(this.hashMap).forEach((e=>{e.td.reset(),e.count=0,e.sum=0}))}startTimer(e){return h.call(this,e)()}labels(...e){const t=i(this.labelNames,e);return a(this.labelNames,t),{observe:u.call(this,t),startTimer:h.call(this,t)}}remove(...e){const t=i(this.labelNames,e);a(this.labelNames,t),o.call(this,this.hashMap,t)}}},401:(e,t,s)=>{"use strict";const{TDigest:r}=s(378);function i(){let e=Date.now()-this.lastRotateTimestampMillis;for(;e>this.durationBetweenRotatesMillis&&this.shouldRotate;)this.ringBuffer[this.currentBuffer]=new r,++this.currentBuffer>=this.ringBuffer.length&&(this.currentBuffer=0),e-=this.durationBetweenRotatesMillis,this.lastRotateTimestampMillis+=this.durationBetweenRotatesMillis;return this.ringBuffer[this.currentBuffer]}e.exports=class{constructor(e,t){this.maxAgeSeconds=e||0,this.ageBuckets=t||0,this.shouldRotate=e&&t,this.ringBuffer=Array(t).fill(new r),this.currentBuffer=0,this.lastRotateTimestampMillis=Date.now(),this.durationBetweenRotatesMillis=1e3*e/t||1/0}percentile(e){return i.call(this).percentile(e)}push(e){i.call(this),this.ringBuffer.forEach((t=>{t.push(e)}))}reset(){this.ringBuffer.forEach((e=>{e.reset()}))}compress(){this.ringBuffer.forEach((e=>{e.compress()}))}}},580:(e,t)=>{"use strict";function s(e){let t=Object.keys(e);if(0===t.length)return"";t.length>1&&(t=t.sort());let s="",r=0;const i=t.length;for(;r<i-1;r++)s+=`${t[r]}:${e[t[r]]},`;return s+=`${t[r]}:${e[t[r]]}`,s}t.getValueAsString=function(e){return Number.isNaN(e)?"Nan":Number.isFinite(e)?`${e}`:e<0?"-Inf":"+Inf"},t.removeLabels=function(e,t){delete e[s(t)]},t.setValue=function(e,t,r){return e[s(r)]={value:"number"==typeof t?t:0,labels:r||{}},e},t.getLabels=function(e,t){if("object"==typeof t[0])return t[0];if(e.length!==t.length)throw new Error("Invalid number of arguments");const s={};for(let r=0;r<e.length;r++)s[e[r]]=t[r];return s},t.hashObject=s,t.isObject=function(e){return e===Object(e)};class r extends Map{add(e,t){this.has(e)?this.get(e).push(t):this.set(e,[t])}}t.Grouper=r},609:(e,t,s)=>{"use strict";const r=s(837),i=/^[a-zA-Z_:][a-zA-Z0-9_:]*$/,n=/^[a-zA-Z_][a-zA-Z0-9_]*$/;t.validateMetricName=function(e){return i.test(e)},t.validateLabelName=function(e=[]){return e.every((e=>n.test(e)))},t.validateLabel=function(e,t){for(const s in t)if(!e.includes(s))throw new Error(`Added label "${s}" is not included in initial labelset: ${r.inspect(e)}`)}},378:(e,t,s)=>{var r=s(424).RBTree;function i(e,t,s){this.discrete=!1===e,this.delta=e||.01,this.K=void 0===t?25:t,this.CX=void 0===s?1.1:s,this.centroids=new r(n),this.nreset=0,this.reset()}function n(e,t){return e.mean>t.mean?1:e.mean<t.mean?-1:0}function o(e,t){return e.mean_cumn-t.mean_cumn}function a(e){this.config=e||{},this.mode=this.config.mode||"auto",i.call(this,"cont"===this.mode&&e.delta),this.digest_ratio=this.config.ratio||.9,this.digest_thresh=this.config.thresh||1e3,this.n_unique=0}i.prototype.reset=function(){this.centroids.clear(),this.n=0,this.nreset+=1,this.last_cumulate=0},i.prototype.size=function(){return this.centroids.size},i.prototype.toArray=function(e){var t=[];return e?(this._cumulate(!0),this.centroids.each((function(e){t.push(e)}))):this.centroids.each((function(e){t.push({mean:e.mean,n:e.n})})),t},i.prototype.summary=function(){return[(this.discrete?"exact ":"approximating ")+this.n+" samples using "+this.size()+" centroids","min = "+this.percentile(0),"Q1  = "+this.percentile(.25),"Q2  = "+this.percentile(.5),"Q3  = "+this.percentile(.75),"max = "+this.percentile(1)].join("\n")},i.prototype.push=function(e,t){t=t||1,e=Array.isArray(e)?e:[e];for(var s=0;s<e.length;s++)this._digest(e[s],t)},i.prototype.push_centroid=function(e){e=Array.isArray(e)?e:[e];for(var t=0;t<e.length;t++)this._digest(e[t].mean,e[t].n)},i.prototype._cumulate=function(e){if(!(this.n===this.last_cumulate||!e&&this.CX&&this.CX>this.n/this.last_cumulate)){var t=0;this.centroids.each((function(e){e.mean_cumn=t+e.n/2,t=e.cumn=t+e.n})),this.n=this.last_cumulate=t}},i.prototype.find_nearest=function(e){if(0===this.size())return null;var t=this.centroids.lowerBound({mean:e}),s=null===t.data()?t.prev():t.data();if(s.mean===e||this.discrete)return s;var r=t.prev();return r&&Math.abs(r.mean-e)<Math.abs(s.mean-e)?r:s},i.prototype._new_centroid=function(e,t,s){var r={mean:e,n:t,cumn:s};return this.centroids.insert(r),this.n+=t,r},i.prototype._addweight=function(e,t,s){t!==e.mean&&(e.mean+=s*(t-e.mean)/(e.n+s)),e.cumn+=s,e.mean_cumn+=s/2,e.n+=s,this.n+=s},i.prototype._digest=function(e,t){var s=this.centroids.min(),r=this.centroids.max(),i=this.find_nearest(e);if(i&&i.mean===e)this._addweight(i,e,t);else if(i===s)this._new_centroid(e,t,0);else if(i===r)this._new_centroid(e,t,this.n);else if(this.discrete)this._new_centroid(e,t,i.cumn);else{var n=i.mean_cumn/this.n;Math.floor(4*this.n*this.delta*n*(1-n))-i.n>=t?this._addweight(i,e,t):this._new_centroid(e,t,i.cumn)}this._cumulate(!1),!this.discrete&&this.K&&this.size()>this.K/this.delta&&this.compress()},i.prototype.bound_mean=function(e){var t=this.centroids.upperBound({mean:e}),s=t.prev();return[s,s.mean===e?s:t.next()]},i.prototype.p_rank=function(e){var t=(Array.isArray(e)?e:[e]).map(this._p_rank,this);return Array.isArray(e)?t:t[0]},i.prototype._p_rank=function(e){if(0!==this.size()){if(e<this.centroids.min().mean)return 0;if(e>this.centroids.max().mean)return 1;this._cumulate(!0);var t=this.bound_mean(e),s=t[0],r=t[1];if(this.discrete)return s.cumn/this.n;var i=s.mean_cumn;return s!==r&&(i+=(e-s.mean)*(r.mean_cumn-s.mean_cumn)/(r.mean-s.mean)),i/this.n}},i.prototype.bound_mean_cumn=function(e){this.centroids._comparator=o;var t=this.centroids.upperBound({mean_cumn:e});this.centroids._comparator=n;var s=t.prev();return[s,s&&s.mean_cumn===e?s:t.next()]},i.prototype.percentile=function(e){var t=(Array.isArray(e)?e:[e]).map(this._percentile,this);return Array.isArray(e)?t:t[0]},i.prototype._percentile=function(e){if(0!==this.size()){this._cumulate(!0),this.centroids.min(),this.centroids.max();var t=this.n*e,s=this.bound_mean_cumn(t),r=s[0],i=s[1];return i===r||null===r||null===i?(r||i).mean:this.discrete?t<=r.cumn?r.mean:i.mean:r.mean+(t-r.mean_cumn)*(i.mean-r.mean)/(i.mean_cumn-r.mean_cumn)}},i.prototype.compress=function(){if(!this.compressing){var e,t,s=this.toArray();for(this.reset(),this.compressing=!0;s.length>0;)this.push_centroid((e=s,void 0,t=Math.floor(Math.random()*e.length),e.splice(t,1)[0]));this._cumulate(!0),this.compressing=!1}},a.prototype=Object.create(i.prototype),a.prototype.constructor=a,a.prototype.push=function(e){i.prototype.push.call(this,e),this.check_continuous()},a.prototype._new_centroid=function(e,t,s){this.n_unique+=1,i.prototype._new_centroid.call(this,e,t,s)},a.prototype._addweight=function(e,t,s){1===e.n&&(this.n_unique-=1),i.prototype._addweight.call(this,e,t,s)},a.prototype.check_continuous=function(){return!("auto"!==this.mode||this.size()<this.digest_thresh)&&this.n_unique/this.size()>this.digest_ratio&&(this.mode="cont",this.discrete=!1,this.delta=this.config.delta||.01,this.compress(),!0)},e.exports={TDigest:i,Digest:a}},1:e=>{"use strict";e.exports=require("cluster")},147:e=>{"use strict";e.exports=require("fs")},685:e=>{"use strict";e.exports=require("http")},687:e=>{"use strict";e.exports=require("https")},74:e=>{"use strict";e.exports=require("perf_hooks")},282:e=>{"use strict";e.exports=require("process")},310:e=>{"use strict";e.exports=require("url")},837:e=>{"use strict";e.exports=require("util")},655:e=>{"use strict";e.exports=require("v8")}},t={};function s(r){var i=t[r];if(void 0!==i)return i.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,s),n.exports}s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";s(76)})()})();